<script lang="ts">
	import * as Item from '$lib/components/ui/item/index.js';
	import * as Dialog from '$lib/components/ui/dialog/index.js';

	import { deleteSteps, getStudySteps } from '$lib/remote/tools.remote';
	import Button, { buttonVariants } from '$lib/components/ui/button/button.svelte';
	import { Maximize2, RefreshCcw } from '@lucide/svelte';
	import Muted from '$lib/components/Muted.svelte';
</script>

<div class="flex justify-between">
	<h1 class="mb-4 text-xl font-bold">Study Plan</h1>
	<Button
		variant="ghost"
		size="icon-sm"
		title="Refresh steps"
		onclick={async () => await getStudySteps().refresh()}><RefreshCcw /></Button
	>
</div>
<svelte:boundary>
	{#if await getStudySteps()}
		<Button onclick={async () => await deleteSteps()}>Delete</Button>
		<ul class="space-y-2 overflow-scroll">
			{#each await getStudySteps() as step (step.id)}
				<Item.Root variant="outline" class="flex-col items-start gap-2">
					<Item.Content>
						<Item.Title
							>{Intl.DateTimeFormat('en-gb', { dateStyle: 'medium' }).format(step.date)}</Item.Title
						>
						<Item.Description>{step.title}</Item.Description>
					</Item.Content>
					<Item.Actions>
						<Dialog.Root>
							<Dialog.Trigger class={buttonVariants({ variant: 'outline', size: 'sm' })}
								><Maximize2 />Details</Dialog.Trigger
							>
							<Dialog.Content>
								<Dialog.Header>
									<Dialog.Title>{step.title}</Dialog.Title>
									<Dialog.Description>
										{step.description}
									</Dialog.Description>
								</Dialog.Header>
							</Dialog.Content>
						</Dialog.Root>
					</Item.Actions>
				</Item.Root>
			{/each}
		</ul>
	{:else}
		<Muted
			>No study plan generated yet. Prompt the chat to generate one or refresh with the button above</Muted
		>
	{/if}
</svelte:boundary>
